import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
df=pd.read_csv('Pandas/Dataset/top-300-youtube-channels.csv')



print(df.info())
def categorie_anne(Channel_Started):
    if Channel_Started in range(2005,2015):
        return "Ancien" 
    else:
        return "recent"
df['categorie_anne']=df['Channel_Started'].apply(categorie_anne)

categorie_moyenne=df.groupby('Genre')['Subscriber_Count'].mean()
top_5=df['Genre'].value_counts().head(5)
top_5_min=df['Genre'].value_counts().sort_values(ascending=True).head(5)
nombre_annee_chaine=df['Channel_Started'].value_counts()
print(nombre_annee_chaine)
print(f"Top 5 des categories les moins preseent\n{top_5_min}")
moyenne=df['Subscriber_Count'].mean()
print(f"Moyenne d'abonné {moyenne}")
top_5_abonne=df[['Channel_Name','Subscriber_Count','Genre',"categorie_anne","Channel_Started"]].sort_values(by="Subscriber_Count",ascending=False).head(5)
top_10_chaine_abonne=df[['Channel_Name','Subscriber_Count',"categorie_anne","Channel_Started","Genre"]].sort_values(by="Subscriber_Count",ascending=False).head(10)
top_10_chaine_vue=df[['Channel_Name','Video_Views',"categorie_anne"]].sort_values(by="Video_Views",ascending=False).head(10)
top_5_nombre_vue=df[['Channel_Name','Video_Views','Genre']].sort_values(by="Video_Views",ascending=False).head(5)
moyenne_abonne_anne=df.groupby('Channel_Started')['Subscriber_Count'].mean()
fig,axe=plt.subplots(nrows=2,ncols=2,figsize=(14,10),dpi=100)
fig.subplots_adjust(left=None,
    bottom=None,
    right=None,
    top=0.3,
    wspace=0.4,
    hspace=0.5,)
##categorie les plus present

sns.barplot(x=top_5.index,y=top_5.values,palette="magma",ax=axe[0,0])
axe[0][0].set_title('Repartition des categories les plus frequents')
sns.barplot(x=top_5_nombre_vue['Channel_Name'],y=top_5_nombre_vue['Video_Views'],hue=top_5_nombre_vue['Genre'],ax=axe[0,1])
axe[0][1].set_title("Top 5 des chaines ayant le plus de vues")
sns.barplot(x=top_10_chaine_abonne['Channel_Name'],y=top_10_chaine_abonne['Subscriber_Count'],ax=axe[1,1])
axe[1][1].set_title("Top 10 des chaine ayant le plus d'abonnées")

sns.countplot(x="Channel_Started",data=df,ax=axe[1,0],palette="Set1")
axe[1,0].set_title('Repartition des creation des chaines par année')
#axe[1, 0].legend(loc='upper right', title='Categorie', fontsize='small')
axe[1,0].legend(prop={'size': 7, 'family': 'serif', 'style': 'italic'})
for ax in axe.flat:
    for label in ax.get_xticklabels():
        label.set_rotation(45)
        label.set_ha('right')
plt.tight_layout() 
plt.tight_layout()
fig.savefig('Pandas/Images/repartion.png',dpi=200)       
plt.show()
sns.boxplot(x="Genre",y="Subscriber_Count",data=df)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
plt.figure(figsize=(14,10))
top_5_min.plot(kind="barh")
plt.title('Repartition des categorie les moins frequentes')
plt.savefig('Pandas/Images/top_5_min_chaine.png',dpi=100)
plt.show()
##Repartion des abonnées par chaines
#fig=plt.subplots(figsize=(10,8))
fig=plt.figure(figsize=(12,9))
g=sns.scatterplot(x=df["Channel_Name"].head(10),y="Subscriber_Count",data=df,hue="Genre",palette="tab10")
plt.xticks(rotation=45,ha="right")
plt.tight_layout()
plt.savefig('Pandas/Images/Repartion_chaine.png')
plt.show()
g=sns.barplot(x=top_5_abonne['Channel_Name'],y=top_5_abonne['Subscriber_Count'],palette="Set1",hue=top_5_abonne['Genre'])
plt.title("Top 5 des chaine ayant le plus d'abonnées")
plt.xticks(rotation=45,ha="right")
plt.legend(loc='upper right', title='Categorie', fontsize='small')
plt.savefig('Pandas/Images/top5_chaines_abonnee.png')
plt.tight_layout()
plt.show()
top_5_abonne.plot(kind="barh")
plt.show()
sns.lineplot(x=nombre_annee_chaine.index,y=nombre_annee_chaine.values,marker="o",lw=2,ls=":",color="b")
plt.title("Courbe temporelle de la creation des chaines au fil des ans")
plt.xticks(rotation=45,ha="right")
plt.savefig("Pandas/Images/Courbe_temporelle_creation_chaine.png")
plt.tight_layout()
plt.show()   
annee_ancienne=df[df['Channel_Started'].between(2005,2015)]
plt.figure(figsize=(12,12))
sns.barplot(x=top_10_chaine_abonne["Channel_Name"],y=top_10_chaine_abonne["Subscriber_Count"],hue=top_10_chaine_abonne["categorie_anne"],palette='Paired')
plt.xticks(rotation=45,ha="right")
plt.title("Repartition des top 10 des meilleur chaines en terme d'abonnées en fonction de la categorie d'année")
plt.tight_layout()
plt.savefig("Pandas/Images/Top_10_des_chaines_annee.png")
plt.show()
plt.figure(figsize=(12,12))
sns.scatterplot(x="Channel_Started",y="Subscriber_Count",data=df,hue="categorie_anne")
plt.title("Repartition des chaines par rapport aux abonnées et en fonction des années")
plt.tight_layout()
plt.savefig("Pandas/Images/repartiton_anne_abonne.png")
plt.show()
moyenne_abonne_anne=df.groupby('Channel_Started')['Subscriber_Count'].mean()
plt.figure(figsize=(12,8),dpi=100)
moyenne_abonne_anne.plot(kind="bar")
plt.title("Repartition de la moyenne d'abonnée par année")
plt.xticks(rotation=45,ha="right")
plt.tight_layout()
plt.savefig("Pandas/Images/repartiton_anne_moyen_abonne.png")
plt.show()
plt.figure(figsize=(12,8),dpi=100)
sns.countplot(x="Channel_Started",data=df,hue="Genre",palette='Set1')
plt.title('Repartition du nombre de categorie crée par année',loc="center",color="blue")
plt.ylabel('Nombre')
plt.tight_layout()
plt.savefig('Pandas/Images/Repartition de creation des categories des chaine par année.png')
plt.show()
plt.figure(figsize=(12,8),dpi=100)
sns.barplot(x="Channel_Started",y="Subscriber_Count",data=df,hue="categorie_anne")
plt.title("Repartition d'abonnée par année")
#plt.savefig("Pandas/Images/repartiton_anne_abonne.png")
plt.show()
print(df.groupby('Channel_Started')['Channel_Started'].value_counts())
plt.figure(figsize=(12,8),dpi=100)
sns.scatterplot(x="Subscriber_Count",y="Video_Views",data=df,hue="categorie_anne")
plt.xticks(rotation=45,ha="right")
plt.title("repartion des aboonées en fonction du nombre de vues")
plt.tight_layout()
plt.savefig('Pandas/Images/repartition_abonnes_nombre_vue.png')
plt.show()
repartion_vue_abonne=df[['Channel_Name','Video_Views',"Subscriber_Count"]].head(30)
sns.catplot(x=repartion_vue_abonne['Subscriber_Count'],y=repartion_vue_abonne['Video_Views'],hue=repartion_vue_abonne['Channel_Name'],kind="bar")
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
top_10_chaine_abonne_categorie=df.loc[df.groupby('categorie_anne')['Subscriber_Count'].idxmax().sort_values(ascending=False).head(10)].reset_index()
print("Top 10,categorie\n",top_10_chaine_abonne_categorie)
sns.catplot(x=top_10_chaine_abonne_categorie['Channel_Name'],y=top_10_chaine_abonne_categorie['Subscriber_Count'],hue="categorie_anne",kind="bar",data=top_10_chaine_abonne_categorie,palette={"Ancien":"red","recent":"pink"})
plt.xticks(rotation=45,ha="right")
plt.title("Repartion des deux meilleurs chaines en terme du nombre d'abonnée regroupé par categorie d'année")
plt.tight_layout()
plt.show()
plt.savefig('Pandas/Images/Top 10 chaines vue.png',dpi=100)
meilleur_chaine_abonne_anne=df.loc[df.groupby("Channel_Started")['Subscriber_Count'].idxmax()]
meilleur_chaine_nombre_de_vue_anne=df.loc[df.groupby(["Channel_Started",'Genre'])['Video_Views'].idxmax()].reset_index()
print('Meilleur chaine par nombre de vue regroupé par anne:\n',meilleur_chaine_nombre_de_vue_anne[['Genre','Video_Views','Channel_Started']])
meilleur_categorie=df.loc[df.groupby("Channel_Started")['Subscriber_Count'].idxmax()]
print("Meilleur categorie par année vue le nombre d'abonnée:\n",meilleur_categorie[['Genre','Subscriber_Count','Channel_Started']])
print("Meilleur chaine par année:\n",meilleur_chaine_abonne_anne[['Channel_Name','Subscriber_Count','Channel_Started']])
#sns.catplot(x=meilleur_chaine_nombre_de_vue_anne['Video_Views'],y=meilleur_chaine_nombre_de_vue_anne['Channel_Name'],hue=meilleur_chaine_nombre_de_vue_anne['Genre'],kind="bar")
"""meilleur_chaine_nombre_de_vue_anne.plot(kind="barh")
plt.title('Meilleur chaine en terme de de vue des video regroupé par genre et par année.',loc="center",color='yellow')
plt.xticks(rotation=45,ha="right")
plt.tight_layout()
plt.savefig("Pandas/Images/Meilleur chaine en terme de de vue des video regroupé par genre et par année.png")
plt.show()"""
sns.barplot(x=categorie_moyenne.index,y=categorie_moyenne.values,palette="tab10")
plt.title('Repartion de la moyenne des abonné par categorie')
plt.xticks(rotation=45,ha="right")
plt.tight_layout()
plt.savefig("Pandas/Images/Moyenne d'abonné par categorie.png")
plt.show()
plt.figure(figsize=(12,8),dpi=100)
sns.catplot(x=meilleur_chaine_abonne_anne['Channel_Started'],y=meilleur_chaine_abonne_anne['Subscriber_Count'],hue=meilleur_chaine_abonne_anne['Channel_Name'],palette="tab10",legend_out=True,kind="bar")
plt.title("Meilleur chaine par année en fonction au nombre d'abonné",loc="center")
plt.xticks(rotation=30)

plt.savefig("Pandas/Images/Repartition de la meilleur chaine par année en fonction du nombre d'abonnée.png",dpi=100)
plt.show()  
plt.figure(figsize=(12,8),dpi=100)
sns.catplot(x=meilleur_categorie['Channel_Started'],y=meilleur_categorie['Subscriber_Count'],hue=meilleur_categorie['Genre'],palette="tab10",legend_out=True,kind="bar")
plt.title("Meilleur categorie par année en fonction du nombre d'abonné",loc="center")
plt.xticks(rotation=30)
plt.savefig("Pandas/Images/Repartition de la meilleur categorie par année en fonction du nombre d'abonnée.png",dpi=100)
plt.show()
meilleur_categorie=df.groupby('Genre')['Subscriber_Count'].sum().sort_values(ascending=False)
plt.figure(figsize=(10,10))
sns.catplot(x=meilleur_categorie.index,y=meilleur_categorie.values,kind="bar")
plt.title("Repartition d'abonnée par categorie")
plt.xticks(rotation=45,ha="right")
plt.savefig("Pandas/Images/Reparttion_abonnée_par_categorie.png",dpi=100,bbox_inches="tight")
plt.show()
Repartition_categorie=df.groupby(['Channel_Started',"Genre"])['Subscriber_Count'].sum().sort_values(ascending=False).reset_index()
sns.barplot(x="Channel_Started",y="Subscriber_Count",hue="Genre",data=Repartition_categorie,palette="tab10")
plt.title("Repartition d'abonné par categorie en fonction des années",fontsize=16,loc="center")
plt.xlabel('Année',fontsize=16,loc="center")
plt.ylabel('Somme des abonnées',fontsize=16,loc="center")
plt.xticks(rotation=45,ha="right")
plt.tight_layout()
plt.savefig('Pandas/Images/Repartion_categorie_anne_detaillé.png',dpi=100)
plt.show()

"""repartion_pivot=Repartition_categorie.pivot(index="Channel_Started",columns="Genre",values="Subscriber_Count")

repartion_pivot.plot(kind="scatter",stacked=True,colormap="viridis",alpha=0.8,figsize=(12,8))
plt.title("Repartition d'abonné par categorie et par année",fontsize=16,loc="center")
plt.xlabel('Année')
plt.ylabel('Somme des abonnées')
plt.xticks(rotation=45,ha="right")
plt.show()"""